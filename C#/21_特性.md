# C# 特性（Attribute）

- 特性（Attribute）是用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签。您可以通过使用特性向程序添加声明性信息。一个声明性标签是通过放置在它所应用的元素前面的方括号（[ ]）来描述的。

## 规定特性（Attribute）

```csharp
[attribute(positional_parameters, name_parameter = value, ...)]
element
```

## 预定义特性（Attribute）

### AttributeUsage

- 预定义特性 AttributeUsage 描述了如何使用一个自定义特性类。
- 参数 validon 规定特性可被放置的语言元素。它是枚举器 AttributeTargets 的值的组合。默认值是 AttributeTargets.All。
- 参数 allowmultiple（可选的）为该特性的 AllowMultiple 属性（property）提供一个布尔值。如果为 true，则该特性是多用的。默认值是 false（单用的）。
- 参数 inherited（可选的）为该特性的 Inherited 属性（property）提供一个布尔值。如果为 true，则该特性可被派生类继承。默认值是 false（不被继承）。

### Conditional

- 这个预定义特性标记了一个条件方法，其执行依赖于指定的预处理标识符。

- 它会引起方法调用的条件编译，取决于指定的值，比如 Debug 或 Trace。

```csharp
[Conditional(
   conditionalSymbol
)]
```

### Obsolete

- 这个预定义特性标记了不应被使用的程序实体。

```csharp
[Obsolete(
   message
)]
[Obsolete(
   message,
   iserror
)]
```

- 参数 message，是一个字符串，描述项目为什么过时以及该替代使用什么。
- 参数 iserror，是一个布尔值。如果该值为 true，编译器应把该项目的使用当作一个错误。默认值是 false（编译器生成一个警告）。

## 创建自定义特性（Attribute）

### 创建并使用自定义特性包含四个步骤：

- 声明自定义特性
- 构建自定义特性
- 在目标程序元素上应用自定义特性
- 通过反射访问特性

### 声明自定义特性

```csharp
// 一个自定义特性 BugFix 被赋给类及其成员
[AttributeUsage(AttributeTargets.Class |
AttributeTargets.Constructor |
AttributeTargets.Field |
AttributeTargets.Method |
AttributeTargets.Property,
AllowMultiple = true)]

public class DeBugInfo : System.Attribute
```

### 构建自定义特性

- bug 的代码编号
- 辨认该 bug 的开发人员名字
- 最后一次审查该代码的日期
- 一个存储了开发人员标记的字符串消息
