# Rust 文件与 IO

## 接收命令行参数

```rust
// Rust 中主函数是个无参函数，环境参数需要开发者通过 std::env 模块取出
fn main() {
    let args = std::env::args();
    println!("{:?}", args);
}
```

```bash
Args { inner: ["D:\\rust\\greeting\\target\\debug\\greeting.exe"] }
```

## 命令行输入

```rust
use std::io::stdin;

fn main() {
let mut str_buf = String::new();

    stdin().read_line(&mut str_buf)
        .expect("Failed to read line.");

    println!("Your input line is \n{}", str_buf);
}
```

## 文件读取

```rust
// 文本文件内容读入字符串
use std::fs;

fn main() {
    let text = fs::read_to_string("D:\\text.txt").unwrap();
    println!("{}", text);
}

// 读取的二进制文件， 结果是 u8 类型集合
use std::fs;

fn main() {
    let content = fs::read("D:\\text.txt").unwrap();
    println!("{:?}", content);
}

// Rust 中的文件流读取方式：
use std::io::prelude::*;
use std::fs;

fn main() {
    let mut buffer = [0u8; 5];
    let mut file = fs::File::open("D:\\text.txt").unwrap();
    file.read(&mut buffer).unwrap();
    println!("{:?}", buffer);
    file.read(&mut buffer).unwrap();
    println!("{:?}", buffer);
}

```

## 文件写入

- 打开的文件一定存放在可变的变量中才能使用 File 的方法

```rust
// 一次性写入
use std::fs;

fn main() {
    fs::write("D:\\text.txt", "FROM RUST PROGRAM")
        .unwrap();
}

// 流的方式写入文件
use std::io::prelude::*;
use std::fs::File;

fn main() {
    let mut file = File::create("D:\\text.txt").unwrap();
    file.write(b"FROM RUST PROGRAM").unwrap();
}

// File 类中不存在 append 静态方法，但是我们可以使用 OpenOptions 来实现用特定方法打开文件：
use std::io::prelude::*;
use std::fs::OpenOptions;

fn main() -> std::io::Result<()> {
    
    let mut file = OpenOptions::new()
            .append(true).open("D:\\text.txt")?;

    file.write(b" APPEND WORD")?;

    Ok(())
}

// 以读写权限打开一个文件
use std::io::prelude::*;
use std::fs::OpenOptions;

fn main() -> std::io::Result<()> {
    
    let mut file = OpenOptions::new()
            .read(true).write(true).open("D:\\text.txt")?;

    file.write(b"COVER")?;

    Ok(())
}
```
